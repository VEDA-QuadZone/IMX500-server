# IMX500-server

λ³Έ ν”„λ΅μ νΈλ” **VEDA-QuadZone**μ΄λΌλ” μ΄λ¦„μ λΌμ¦λ² λ¦¬νμ΄ κΈ°λ° CCTV AI μ‹μ¤ν…μΌλ΅,  
IMX500 AI μΉ΄λ©”λΌλ¥Ό μ΄μ©ν•΄ μ‹¤μ‹κ°„ κ°μ²΄ κ°μ§€, μ°¨λ‰ λ²νΈν μΈμ‹, μ†λ„ μΈ΅μ • λ“±μ λ‹¤μ–‘ν• μ΄λ²¤νΈλ¥Ό μ²λ¦¬ν•κ³ ,  
RTSPλ¥Ό ν†µν•΄ μ‹¤μ‹κ°„ μ¤νΈλ¦¬λ°κ³Ό μ΄λ²¤νΈ κΈ°λ° μ•λ¦Όμ„ μ κ³µν•λ” κ²ƒμ΄ λ©μ μ…λ‹λ‹¤.

μ΄ λ ν¬μ§€ν† λ¦¬μΈ **IMX500-server**λ” μ „μ²΄ μ‹μ¤ν…μ **μ„λ²„**λ΅μ„,  
IMX500 μΉ΄λ©”λΌλ΅λ¶€ν„° μμ‹ ν• μ¶”λ΅  κ²°κ³Όμ™€ ν”„λ μ„μ„ κΈ°λ°μΌλ΅ λ‹¤μ κΈ°λ¥μ„ μν–‰ν•©λ‹λ‹¤:

- μ°¨λ‰ λ° μ‚¬λμ— λ€ν• κ°μ§€ μ΄λ²¤νΈ ν›„μ²λ¦¬
- μ°¨λ‰ λ²νΈν μΈμ‹ (ONNX + TFLite)
- μ΄λ²¤νΈ κ°μ§€ λ° λ¶„λ¥ (λ¶λ²• μ£Όμ •μ°¨, κ³Όμ† λ“±)
- RTSPλ¥Ό ν†µν• μ‹¤μ‹κ°„ μμƒ μ†΅μ¶

μµμΆ…μ μΌλ΅ κ°μ§€ κ²°κ³Όλ” TCP μ„λ²„μ™€ Qt κΈ°λ° λ¨λ‹ν„°λ§ ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅λμ–΄ μ‹¤μ‹κ°„ ν™•μΈμ΄ κ°€λ¥ν•©λ‹λ‹¤.

---
## π“ ν”„λ΅μ νΈ μ „μ²΄ κµ¬μ„±λ„

- **μΉ΄λ©”λΌ μ„λ²„ (IMX500)**
  - κ°μ²΄ κ°μ§€ λ° ν”„λ μ„ μ¶”μ¶  
    (_.rpk μ¶”λ΅ , libcamera κΈ°λ°_)

- **[IMX500-server]** β† λ³Έ λ ν¬μ§€ν† λ¦¬
  - AI κ°μ§€ ν›„μ²λ¦¬
  - λ²νΈν μΈμ‹ (ONNX + TFLite)
  - μ΄λ²¤νΈ κ°μ§€ λ° μ²λ¦¬
  - μ‹¤μ‹κ°„ RTSP μ†΅μ¶

- **[raspi-cctv-tcp-server]**
  - μ°¨λ‰ μ†λ„ μ΄λ²¤νΈ μμ‹ 
  - TCP κΈ°λ° λ©”μ‹μ§€ μ²λ¦¬ μ„λ²„

- **[QuadQT]**
  - Qt κΈ°λ° λ¨λ‹ν„°λ§ ν΄λΌμ΄μ–ΈνΈ
  - RTSP μ¤νΈλ¦¬λ° μμƒ ν‘μ‹
  - μ΄λ²¤νΈ μμ‹  λ° UI μ•λ¦Ό
---
## π› οΈ κΈ°μ  μ¤νƒ

| κµ¬λ¶„               | μ‚¬μ© ν™κ²½ / ν΄              | λ²„μ „                      | μ©λ„                                 |
|--------------------|-----------------------------|----------------------------|--------------------------------------|
| ν΄λΌμ΄μ–ΈνΈ κ°λ°    | Qt (Windows)                | 6.9.1                      | λ¨λ‹ν„°λ§ UI κ°λ°, RTSP μμƒ μ¬μƒ     |
| μμƒ μ²λ¦¬ λΌμ΄λΈλ¬λ¦¬ | OpenCV                      | 4.6.0                      | μ΄λ―Έμ§€ ν”„λ μ„ μ²λ¦¬ λ° ν…μ¤νΈ          |
| μμƒ μΈμ½”λ”©/λ””μ½”λ”© | FFmpeg                      | 5.1.6                      | H.264 μΈμ½”λ”© λ° μ¤νΈλ¦¬λ°             |
| μ„λ²„ κ°λ° (TCP)    | Raspberry Pi OS (Linux)     | Debian GNU/Linux 12       | μ°¨λ‰ μ†λ„ μ΄λ²¤νΈ μμ‹  μ„λ²„           |
| μΉ΄λ©”λΌ μ„λ²„        | Raspberry Pi OS (Linux)     | λ™μΌ                       | IMX500 μΉ΄λ©”λΌ μ—°λ™                    |
| μ»¤λ„               | Linux Kernel                | 6.1.21 aarch64             | λ””λ°”μ΄μ¤ μ μ–΄, λ„¤νΈμ›ν¬               |
| νμ›¨μ–΄ κ°λ°        | STM32CubeIDE                | 1.13.0                     | μ†λ„ κ°μ§€ μ„Όμ„ νμ›¨μ–΄ κ°λ°           |
| μ–Έμ–΄               | C/C++                       | g++ 10.2.1 (Raspberry Pi)  | μ „μ²΄ μ„λ²„ μ½”λ“                        |
| DB                 | SQLite                      | 3.40.1                     | μ΄λ²¤νΈ νμ¤ν† λ¦¬ μ €μ¥                  |
| λ³΄μ•               | OpenSSL                     | 3.0.16                     | TLS κΈ°λ° ν†µμ‹  μ•”νΈν™”                  |
| κ°μ²΄ κ°μ§€          | IMX500 λ‚΄λ¶€ .rpk λ¨λΈ       | Sony Neural Network        | μ°¨λ‰/μ‚¬λ κ°μ§€ (μ—£μ§€ μ¶”λ΅ )           |
| λ²νΈν νƒμ§€        | ONNX Runtime (C++)          | 1.16.0                     | μ°¨λ‰ λ²νΈν μ„μΉ κ°μ§€                 |
| λ²νΈν μΈμ‹        | TFLite (C++)                | 2.14.0                     | λ²νΈν λ¬Έμ OCR                       |

---

## π“‚ μ£Όμ” λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```bash
IMX500-server/
β”β”€β”€ camera/                # start_camera.sh μ¤ν¬λ¦½νΈ
β”β”€β”€ cpp/
β”‚   β”β”€β”€ build/             # λΉλ“λ μ‹¤ν–‰ νμΌ
β”‚   β”β”€β”€ include/           # κ³µν†µ ν—¤λ” νμΌ
β”‚   β””β”€β”€ src/
β”‚       β”β”€β”€ detect/        # λ²νΈν/λ³΄ν–‰μ/μ†λ„ κ°μ§€
β”‚       β”β”€β”€ mqtt/          # MQTT μ „μ†΅
β”‚       β”β”€β”€ upload/        # μ¤λƒ…μƒ· μ „μ†΅ λ° DB λ“±λ΅
β”‚       β”β”€β”€ stream/        # RTSP μ†΅μ¶
β”‚       β”β”€β”€ control/       # LCD/μ¤ν”Όμ»¤ λ””λ°”μ΄μ¤ μ μ–΄
β”β”€β”€ run_all.sh             # μ „μ²΄ AI λ¨λ“ μ‹¤ν–‰
β”β”€β”€ start_camera.sh        # Picamera2 + IMX500 μ‹¤ν–‰
β””β”€β”€ runlogs/               # λ΅κ·Έ μ €μ¥ ν΄λ”
```

---

## π”§ μ‹μ¤ν… μ‹¤ν–‰ μμ„

### 1. TCP μ΄λ²¤νΈ μ„λ²„ λΉλ“ λ° μ‹¤ν–‰ (`raspi-cctv-tcp-server`)
β†’ μ°¨λ‰ μ†λ„ λ° μ΄λ²¤νΈ μμ‹  μ„λ²„ κµ¬λ™

```bash
cd ~/myproject/raspi-cctv-tcp-server
mkdir build && cd build
cmake ..
make
./raspi-cctv-server
````

---

### 2. IMX500 μ„λ²„ μ‹¤ν–‰ (`IMX500-server`)
β†’ μΉ΄λ©”λΌ κΈ°λ° AI κ°μ§€ λ° μ΄λ²¤νΈ μ†΅μ¶ μ²λ¦¬

```bash
cd ~/myproject/camera
./start_camera.sh    # μΉ΄λ©”λΌ λ° κ³µμ λ©”λ¨λ¦¬ μ—°λ™ μ‹μ‘

cd ~/myproject/cpp/build
./run_all.sh         # λ²νΈν κ°μ§€, OCR, μ΄λ²¤νΈ κ°μ§€ λ“± μ „μ²΄ λ¨λ“ μ‹¤ν–‰
```

---

### 3. Qt ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ (`QuadQT`)

β†’ μ‹¤μ‹κ°„ RTSP μμƒ μ¬μƒ + MQTT μ΄λ²¤νΈ μμ‹ 

```bash
./QuadQT
```

---



## π§  λ‚΄λ¶€ μ²λ¦¬ κµ¬μ΅° (IMX500-server)

### [`start_camera.sh`]
- Picamera2 + IMX500 μ—°λ™
- μ‹¤μ‹κ°„ ν”„λ μ„ β†’ κ³µμ  λ©”λ¨λ¦¬ κΈ°λ΅
- `.rpk` κ²°κ³Ό (ObjectDetectResult) λ©”νƒ€λ°μ΄ν„° κΈ°λ΅

### [`run_all.sh`]
- λ²νΈν νƒμ§€ (ONNX)
- λ²νΈν OCR (TFLite)
- λ¶λ²•μ£Όμ •μ°¨, κ³Όμ†, λ³΄ν–‰μ κ°μ§€
- RTSP μ†΅μ¶ (FFmpeg)
- μ΄λ²¤νΈ MQTT λ°ν–‰
- μ¤λƒ…μƒ· λ° λ©”νƒ€λ°μ΄ν„° κΈ°λ΅ (`/dev/shm`)

---

## π”— μ°Έκ³  λ ν¬μ§€ν† λ¦¬

- **λ²νΈν OCR λ¨λΈ**: [KR_LPR_Jax (by noahzhy)](https://github.com/noahzhy/KR_LPR_Jax)  
  β””β”€ ν•κµ­ λ²νΈν μΈμ‹μ— νΉν™”λ CTC κΈ°λ° TFLite OCR λ¨λΈ
